/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_2021_2_GORYACHIE_MEKSIKANSI"]("main",{

/***/ "./src/components/mapPopup/mapPopup.hbs":
/*!**********************************************!*\
  !*** ./src/components/mapPopup/mapPopup.hbs ***!
  \**********************************************/
/***/ ((module, __unused_webpack_exports, __webpack_require__) => {

eval("var Handlebars = __webpack_require__(/*! ../../../node_modules/handlebars/runtime.js */ \"./node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"compiler\":[8,\">= 4.3.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    return \"<div id=\\\"#popup\\\" class=\\\"map-popup\\\">\\n    <div class=\\\"map-popup__body\\\">\\n        <div class=\\\"map-popup__content\\\">\\n            <div class=\\\"js__confirmation-address-container\\\">\\n                <div class=\\\"map-popup__close-container\\\">\\n                    <div class=\\\"map-popup__title\\\">Введите адрес доставки</div>\\n                    <svg class=\\\"map-popup__close close-popup\\\" width=\\\"30\\\" height=\\\"30\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\">\\n                        <path d=\\\"M8.46458 15.5354L15.5356 8.46436\\\" stroke=\\\"black\\\" stroke-width=\\\"3\\\" stroke-linecap=\\\"round\\\"/>\\n                        <path d=\\\"M8.46458 8.46458L15.5356 15.5356\\\" stroke=\\\"black\\\" stroke-width=\\\"3\\\" stroke-linecap=\\\"round\\\"/>\\n                    </svg>\\n                </div>\\n                <div class=\\\"map-popup__input\\\">\\n                    <input type=\\\"text\\\" id=\\\"js__map-add-address\\\" class=\\\"map__input\\\" placeholder=\\\"Начните вводить адрес\\\"/>\\n                <button id=\\\"js__add-new-address__btn\\\" class=\\\"map-popup__button\\\">Продолжить</button>\\n                </div>\\n                <div id=\\\"js__map\\\" class=\\\"map-popup__address-confirmation\\\"></div>\\n    </div>\\n</div>\\n\";\n},\"useData\":true});\n\n//# sourceURL=webpack://2021_2_GORYACHIE_MEKSIKANSI/./src/components/mapPopup/mapPopup.hbs?");

/***/ }),

/***/ "./src/components/mapPopup/mapPopup.js":
/*!*********************************************!*\
  !*** ./src/components/mapPopup/mapPopup.js ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"MapPopup\": () => (/* binding */ MapPopup)\n/* harmony export */ });\n/* harmony import */ var Modules_yMaps_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! Modules/yMaps.js */ \"./src/modules/yMaps.js\");\n/* harmony import */ var Modules_lsAddress_js__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! Modules/lsAddress.js */ \"./src/modules/lsAddress.js\");\n/* harmony import */ var Modules_eventBus_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! Modules/eventBus.js */ \"./src/modules/eventBus.js\");\n/* harmony import */ var Events_Auth_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! Events/Auth.js */ \"./src/events/Auth.js\");\n/* harmony import */ var _navbar_navbar_js__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! ../navbar/navbar.js */ \"./src/components/navbar/navbar.js\");\n/* harmony import */ var _mapPopup_hbs__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ./mapPopup.hbs */ \"./src/components/mapPopup/mapPopup.hbs\");\n/* harmony import */ var _mapPopup_hbs__WEBPACK_IMPORTED_MODULE_5___default = /*#__PURE__*/__webpack_require__.n(_mapPopup_hbs__WEBPACK_IMPORTED_MODULE_5__);\n\n\n\n\n\n\n\nclass MapPopup {\n    constructor({\n                    parent: parent = document.body,\n                    routeTo: routeTo = () => {\n                    },\n                    controller: controller,\n                }) {\n        this.parent = parent;\n        this.unlock = true;\n        this.timeout = 100;\n    }\n\n    render() {\n        const div = document.createElement('div');\n        div.classList.add('map-popup-div');\n        div.innerHTML = _mapPopup_hbs__WEBPACK_IMPORTED_MODULE_5___default()({});\n        document.body.appendChild(div);\n        this.mapPopupCloseIcon = document.querySelectorAll('.close-popup');\n        this.mapPopupLinks = document.querySelectorAll('.map-popup__link');\n\n        if (this.mapPopupLinks.length > 0) {\n            this.mapPopupLinks.forEach((link) => {\n                link.addEventListener('click', this.eventPopupOpen)\n            });\n        }\n\n        if (this.mapPopupCloseIcon.length > 0) {\n            this.mapPopupCloseIcon.forEach((icon) => {\n                icon.addEventListener('click', this.eventPopupClose)\n            });\n        }\n\n        this.yaMap = new Modules_yMaps_js__WEBPACK_IMPORTED_MODULE_0__.YandexMap();\n        this.yaMap.render({ id: 'js__map', isStatic: false }, (address, isRenew) => {\n            if (isRenew) {\n                document.getElementById('js__map-add-address').value = address.name;\n            }\n            this.setCoords(address.latitude, address.longitude);\n        });\n\n        this.yaMap.addSuggestView('js__map-add-address');\n        const address_ = Modules_lsAddress_js__WEBPACK_IMPORTED_MODULE_1__[\"default\"].getAddress();\n        this.addCloseConfirmationEventListeners(div);\n\n        if (address_.name) {\n            this.yaMap.customPoint(address_);\n        } else {\n            const mapCurrentPopup = document.querySelector('.map-popup');\n            this.mapPopupOpen(mapCurrentPopup);\n        }\n    }\n\n    setCoords (latitude, longitude) {\n        this.latitude = latitude;\n        this.longitude = longitude;\n    }\n\n    settingUp() {\n    }\n\n    eventPopupOpen = (e) => {\n        // const mapPopupName = e.target.getAttribute('href').replace('#', '');\n        const mapCurrentPopup = document.getElementById(e.target.getAttribute('href'));\n        this.mapPopupOpen(mapCurrentPopup);\n        e.preventDefault();\n    }\n\n    eventPopupClose = (e) => {\n        this.mapPopupClose(e.target.closest('.map-popup'));\n        e.preventDefault();\n    }\n\n    remove = () => {\n        if (this.mapPopupLinks.length > 0) {\n            this.mapPopupLinks.forEach((link) => {\n                link.removeEventListener('click', this.eventPopupOpen)\n            });\n        }\n\n        if (this.mapPopupCloseIcon.length > 0) {\n            this.mapPopupCloseIcon.forEach((icon) => {\n                icon.removeEventListener('click', this.eventPopupClose)\n            });\n        }\n\n        const close = this.parent.querySelector('.map-popup');\n        close.querySelector('#js__add-new-address__btn')\n            .removeEventListener('click', this.addAddress)\n\n        if (this.parent.querySelector('.map-popup-div')) {\n            this.parent.removeChild(this.parent.querySelector('.map-popup-div'))\n        }\n    }\n\n    mapPopupOpen(currentPopup) {\n        if (currentPopup && this.unlock) {\n            const popupActive = document.querySelector('.map-popup.open');\n            if (popupActive) {\n                this.mapPopupClose(popupActive, false);\n            } else {\n                this.bodyLock();\n            }\n\n            currentPopup.classList.add('open');\n            currentPopup.addEventListener('click', this.popupOutsideClickEvent);\n        }\n    }\n\n    popupOutsideClickEvent = (e) => {\n        if (!e.target.closest('.map-popup__content')) {\n            this.mapPopupClose(e.target.closest('.map-popup'));\n        }\n    }\n\n    mapPopupClose(popupActive, doUnlock = true) {\n        if (this.unlock) {\n            popupActive.classList.remove('open');\n\n            if (doUnlock) {\n                this.bodyUnlock();\n            }\n        }\n    }\n\n    addCloseConfirmationEventListeners (confirmationItem) {\n        const close = this.parent.querySelector('.map-popup');\n        if (!close) {\n            return;\n        }\n\n        close.querySelector('#js__add-new-address__btn')\n            .addEventListener('click', this.addAddress)\n    }\n\n    addAddress = () => {\n        Modules_yMaps_js__WEBPACK_IMPORTED_MODULE_0__.YandexMap.isAddressCorrect(document.getElementById('js__map-add-address').value)\n            .then(isCorrect => {\n                if (isCorrect) {\n                    const address = isCorrect.properties._data.name\n                    if (address) {\n                        Modules_eventBus_js__WEBPACK_IMPORTED_MODULE_2__[\"default\"].emitEventListener(Events_Auth_js__WEBPACK_IMPORTED_MODULE_3__.AuthStatus.changeAddress, {\n                            longitude: this.longitude,\n                            latitude: this.latitude,\n                            name: isCorrect.properties._data.name,\n                            city: isCorrect.properties._data.metaDataProperty.GeocoderMetaData.Address.Components.find((element) => {\n                                if (element.kind === 'province' && isCorrect.properties._data.text.includes(String(element.name))) {\n                                    return true;\n                                }\n                            }).name,\n                            fullAddress: isCorrect.properties._data.text,\n                        });\n                        this.mapPopupClose(document.querySelector('.map-popup'));\n                        _navbar_navbar_js__WEBPACK_IMPORTED_MODULE_4__[\"default\"].updateAddressName(address)\n                        console.log(this.parent.querySelector('.js-address'))\n                        if (this.parent.querySelector('.js-address')) {\n                            this.parent.querySelector('.js-address').value = String(isCorrect.properties._data.text);\n                        }\n                    } else {\n                        // TODO нужно сделать ошибку...\n                    }\n                }\n            })\n    }\n\n    bodyLock() {\n        this.parent.style.paddingRight =  String(this.getScrollbarWidth()) + 'px';\n        this.parent.style.overflow = 'hidden';\n\n        this.unlock = false;\n        setTimeout(() => {\n            this.unlock = true;\n        }, this.timeout);\n    }\n\n    getScrollbarWidth() {\n        const outer = document.createElement('div');\n        outer.style.visibility = 'hidden';\n        outer.style.overflow = 'scroll';\n        outer.style.msOverflowStyle = 'scrollbar';\n        document.body.appendChild(outer);\n\n        const inner = document.createElement('div');\n        outer.appendChild(inner);\n\n        const scrollbarWidth = (outer.offsetWidth - inner.offsetWidth);\n\n        outer.parentNode.removeChild(outer);\n\n        return scrollbarWidth;\n\n    }\n\n    bodyUnlock() {\n        setTimeout(() => {\n            this.parent.style.paddingRight = '0';\n            this.parent.style.paddingRight = '0';\n            this.parent.style.overflowY = 'scroll';\n        }, this.timeout);\n\n        this.unlock = false;\n        setTimeout(() => {\n            this.unlock = true;\n        }, this.timeout);\n    }\n}\n\n\n//# sourceURL=webpack://2021_2_GORYACHIE_MEKSIKANSI/./src/components/mapPopup/mapPopup.js?");

/***/ }),

/***/ "./src/modules/yMaps.js":
/*!******************************!*\
  !*** ./src/modules/yMaps.js ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"YandexMap\": () => (/* binding */ YandexMap)\n/* harmony export */ });\nclass YandexMap {\n    constructor () {\n        this.initPos = {\n            latitude: 55.751574,\n            longitude: 37.57385\n        };\n    }\n\n    customPoint (pos) {\n            ymaps.ready(() => {\n                this.movePosition(pos);\n                this.setCenter(pos);\n                this.callback(pos, true);\n            });\n        }\n\n    render ({\n                id,\n                pos = this.initPos,\n                isStatic = false\n            } = {}, callback = () => {}) {\n        ymaps.ready(this.start.bind(this, { id, pos, isStatic }, callback));\n    }\n\n    start ({\n              id,\n              pos,\n              isStatic\n          } = {}, callback) {\n        this.callback = callback;\n        this.pos = pos;\n        document.getElementById(id).innerHTML = '';\n        this.map = new ymaps.Map(id, {\n            center: this.refactorToArray(this.pos),\n            zoom: 11,\n            openBalloonOnClick: false,\n            controls: []\n        });\n\n        if (!isStatic) {\n            this.addListeners();\n        }\n    }\n\n    addListeners () {\n        this.map.events.add('click', (e) => {\n            const coords = e.get('coords');\n            this.movePosition(this.convertPosArrayToObject(coords));\n            this.getAddress();\n        });\n    }\n\n    getAddress () {\n        ymaps.geocode(this.refactorToArray(this.pos))\n            .then((res) => {\n                this.catchCallback(res);\n            });\n    }\n\n    catchCallback (res, isRenew = true) {\n        this.text = this.getUserPositionAddress(res.geoObjects.get(0).properties);\n        const address = {\n            name: this.text,\n            latitude: this.pos.latitude,\n            longitude: this.pos.longitude\n        };\n        this.callback(address, isRenew);\n    }\n\n    getUserPositionAddress (properties) {\n        const prop = properties.get('metaDataProperty').GeocoderMetaData.AddressDetails.Country;\n        console.log(prop.AddressLine);\n        return prop.AddressLine;\n    }\n\n    setCenter (pos, zoom) {\n        this.map.setCenter(this.refactorToArray(pos), zoom);\n    }\n\n    addSuggestView (id) {\n        ymaps.ready(() => {\n            const suggestView = new ymaps.SuggestView(id, {\n                offset: [10, 10]\n            });\n            suggestView.events.add('select', (e) => {\n                const myGeocoder = ymaps.geocode(e.originalEvent.item.value, {\n                    kind: 'house',\n                    result: 1,\n                });\n                myGeocoder\n                    .then((res) => {\n                        this.movePosition(this.convertPosArrayToObject(res.geoObjects.get(0).geometry.getCoordinates()));\n                        this.setCenter(this.convertPosArrayToObject(res.geoObjects.get(0).geometry.getCoordinates(), 1));\n                        this.catchCallback(res, false);\n                    }\n                ).catch(\n                    (err) => {\n                        console.log(err.message);\n                    });\n            });\n        });\n    }\n\n    movePosition (pos, radius = 0) {\n        this.addPosition(pos);\n        this.circle = this.changeRadius(radius);\n    }\n\n    addPosition (pos) {\n        if (this.pos) {\n            this.deletePosition(this.point);\n            this.point = this.createPosition(pos);\n        }\n        this.pos = pos;\n    }\n\n    deletePosition (point) {\n        this.map.geoObjects.remove(point);\n    }\n\n    createPosition (pos) {\n        const point = new ymaps.Placemark(this.refactorToArray(pos));\n        this.map.geoObjects.add(point);\n\n        return point;\n    }\n\n    createCircle (pos, radius) {\n        if (!radius) {\n            if (this.radius) {\n                radius = this.radius;\n            }\n        }\n        const circle = new ymaps.Circle([this.refactorToArray(pos), radius]);\n        this.map.geoObjects.add(circle);\n\n        return circle;\n    }\n\n    changeRadius (radius) {\n        if (this.circle) {\n            this.deleteCircle(this.circle);\n        }\n        this.circle = this.createCircle(this.pos, radius);\n        if (radius) {\n            this.radius = radius;\n        }\n        return this.circle;\n    }\n\n    deleteCircle (circle) {\n        this.map.geoObjects.remove(circle);\n    }\n\n    convertPosArrayToObject (coords) {\n        return {\n            latitude: coords[0],\n            longitude: coords[1]\n        };\n    }\n\n    refactorToArray (pos) {\n        return [pos.latitude, pos.longitude];\n    }\n\n    static async isAddressCorrect (address) {\n        const myGeocoder = ymaps.geocode(address);\n        return await myGeocoder.then((res) => res.geoObjects.get(0));\n    }\n}\n\n\n//# sourceURL=webpack://2021_2_GORYACHIE_MEKSIKANSI/./src/modules/yMaps.js?");

/***/ })

},
/******/ function(__webpack_require__) { // webpackRuntimeModules
/******/ /* webpack/runtime/getFullHash */
/******/ (() => {
/******/ 	__webpack_require__.h = () => ("11cd36ac6241b918b512")
/******/ })();
/******/ 
/******/ }
);